<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>Đăng nhập - ShynMMO Games</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
<style>
body{background:#0b0f19;color:#fff;font-family:Inter;margin:0;padding:40px}
.card{max-width:480px;margin:40px auto;background:rgba(255,255,255,.05);padding:30px;border-radius:20px;box-shadow:0 0 20px rgba(0,0,0,.5)}
input{width:100%;padding:12px;border-radius:10px;border:none;margin:8px 0;background:#121826;color:#fff}
button{padding:12px 20px;border:none;border-radius:10px;background:#22d3ee;color:#000;font-weight:700;cursor:pointer}
button:hover{background:#67e8f9}
a{color:#22d3ee;text-decoration:none}
footer{position:fixed;right:20px;bottom:10px;color:#888;font-size:12px;opacity:.6}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="./js/firebase.js"></script>
<script src="./js/util.js"></script>
</head>
<body>
<div class="card">
  <h2>Đăng nhập</h2>
  <input id="username" placeholder="Tên người dùng">
  <input id="password" type="password" placeholder="Mật khẩu">
  <button id="btnLogin">Đăng nhập</button>
  <p>Chưa có tài khoản? <a href="signup.html">Đăng ký</a></p>
</div>
<footer>© ShynMMO Games 2025</footer>

<script>
const $u=$('#username'),$p=$('#password');

$('#btnLogin').onclick=async()=>{
  const username=$u.value.trim().toLowerCase();
  const pass=$p.value.trim();
  if(!username||!pass) return toast("Vui lòng nhập username và mật khẩu");
  const unameRef=_db.ref('usernames/'+username);
  const snap=await unameRef.get();
  if(!snap.exists()) return toast("Không tồn tại username này");
  const email=snap.val().email;
  try{
    const cred=await _auth.signInWithEmailAndPassword(email,pass);
    const user=cred.user;
    const data=await _db.ref('users/'+user.uid).get();
    if(data.exists() && data.val().locked){
      await _auth.signOut();
      return toast("Tài khoản bị khóa");
    }
    toast("Đăng nhập thành công!");
    setTimeout(()=>location.href='baicao.html',1000);
  }catch(err){
    toast("Lỗi: "+err.message);
  }
};
</script>
</body>
</html>
