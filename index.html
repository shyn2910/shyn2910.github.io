<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÄÄƒng nháº­p - Shyn System</title>

<!-- âœ… Firebase compat SDK (dÃ nh cho HTML thuáº§n, hoáº¡t Ä‘á»™ng trÃªn GitHub Pages) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0d1117;
  color: white;
  text-align: center;
}
.container {
  margin-top: 10%;
  background: #161b22;
  padding: 30px;
  border-radius: 10px;
  display: inline-block;
}
input, select {
  margin: 5px;
  padding: 10px;
  width: 250px;
  border: none;
  border-radius: 5px;
}
button {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  background: #238636;
  color: white;
  cursor: pointer;
}
button:hover {
  background: #2ea043;
}
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ” Há»‡ thá»‘ng Shyn</h2>
  <input type="text" id="username" placeholder="TÃªn Ä‘Äƒng nháº­p"><br>
  <input type="password" id="password" placeholder="Máº­t kháº©u"><br>
  <select id="role">
    <option value="user">User</option>
    <option value="admin">Admin</option>
  </select><br>
  <button id="btnRegister">ÄÄƒng kÃ½</button>
  <button id="btnLogin">ÄÄƒng nháº­p</button>
  <p id="msg"></p>
</div>

<script>
// ================== âš™ï¸ Firebase Config (Shyn App) ==================
const firebaseConfig = {
  apiKey: "AIzaSyD9XW1A1ns5cYlV3bI5i4HigR9HyUUYlvQ",
  authDomain: "shyn-app-0709.firebaseapp.com",
  databaseURL: "https://shyn-app-0709-default-rtdb.firebaseio.com",
  projectId: "shyn-app-0709",
  storageBucket: "shyn-app-0709.appspot.com",
  messagingSenderId: "660274057745",
  appId: "1:660274057745:web:ef7300abd53dec95d9d7b0",
  measurementId: "G-2ZKCQ24770"
};
// ==========================================================

window.onload = () => {
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ğŸŸ¢ DOM sáºµn sÃ ng
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const roleInput = document.getElementById('role');
  const msg = document.getElementById('msg');

  async function register() {
    const username = usernameInput.value.trim();
    const password = passwordInput.value;
    const role = roleInput.value;

    if (!username || !password) {
      msg.textContent = "âš ï¸ Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!";
      return;
    }

    const snap = await db.ref('users/' + username).get();
    if (snap.exists()) {
      msg.textContent = "âŒ TÃªn Ä‘Äƒng nháº­p Ä‘Ã£ tá»“n táº¡i!";
      return;
    }

    await db.ref('users/' + username).set({
      password,
      role,
      balance: 0,
      blocked: false,
      todos: [],
      links: []
    });

    msg.textContent = "âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng! Giá» báº¡n cÃ³ thá»ƒ Ä‘Äƒng nháº­p.";
  }

  async function login() {
    const username = usernameInput.value.trim();
    const password = passwordInput.value;

    if (!username || !password) {
      msg.textContent = "âš ï¸ Vui lÃ²ng nháº­p Ä‘á»§ thÃ´ng tin!";
      return;
    }

    const snap = await db.ref('users/' + username).get();
    if (!snap.exists()) {
      msg.textContent = "âŒ TÃ i khoáº£n khÃ´ng tá»“n táº¡i!";
      return;
    }

    const user = snap.val();
    if (user.password !== password) {
      msg.textContent = "âŒ Sai máº­t kháº©u!";
      return;
    }
    if (user.blocked) {
      msg.textContent = "ğŸš« TÃ i khoáº£n cá»§a báº¡n Ä‘Ã£ bá»‹ khÃ³a!";
      return;
    }

    localStorage.setItem('currentUser', username);
    msg.textContent = "âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng! Äang chuyá»ƒn hÆ°á»›ng...";
    setTimeout(() => (location.href = "dashboard.html"), 800);
  }

  document.getElementById('btnRegister').onclick = register;
  document.getElementById('btnLogin').onclick = login;
};
</script>
</body>
</html>
