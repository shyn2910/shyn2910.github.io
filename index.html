<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ﾄ斉ハg nh蘯ｭp Caro Online</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>沁ｮ CARO ONLINE</h2>
  <div class="container">
    <input type="text" id="username" placeholder="Tﾃｪn ngﾆｰ盻拱 dﾃｹng">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="M蘯ｭt kh蘯ｩu">
    <button id="registerBtn">ﾄ斉ハg kﾃｽ</button>
    <button id="loginBtn">ﾄ斉ハg nh蘯ｭp</button>
  </div>

  <script type="module">
    import { db, auth, ref, set, get, child, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "./firebase.js";

    const dbRef = ref(db);
    const username = document.getElementById("username");
    const email = document.getElementById("email");
    const password = document.getElementById("password");

    async function register() {
      if (!username.value || !email.value || !password.value) return alert("Nh蘯ｭp ﾄ黛ｺｧy ﾄ黛ｻｧ thﾃｴng tin!");
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email.value, password.value);
        const user = userCredential.user;
        const snapshot = await get(child(dbRef, "users"));
        const role = (!snapshot.exists()) ? "admin" : "member";
        await set(ref(db, "users/" + user.uid), {
          username: username.value,
          email: email.value,
          balance: role === "admin" ? 1000000 : 0,
          role
        });
        alert("ﾄ斉ハg kﾃｽ thﾃnh cﾃｴng!");
        window.location = role === "admin" ? "admin.html" : "game.html";
      } catch (e) {
        alert(e.message);
      }
    }

    async function login() {
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email.value, password.value);
        const user = userCredential.user;
        const snap = await get(child(dbRef, "users/" + user.uid));
        const data = snap.val();
        window.location = data.role === "admin" ? "admin.html" : "game.html";
      } catch {
        alert("Sai tﾃi kho蘯｣n ho蘯ｷc m蘯ｭt kh蘯ｩu!");
      }
    }

    document.getElementById("registerBtn").onclick = register;
    document.getElementById("loginBtn").onclick = login;
  </script>
</body>
</html>
