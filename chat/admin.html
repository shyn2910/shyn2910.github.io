<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ShynChat Admin Panel v5.1 | Secure by ShynSuite</title>

<!-- ‚úÖ Fix favicon & CORS popup issues -->
<link rel="icon" href="data:,">
<meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-database-compat.js"></script>

<style>
  body {
    background: #0a0a0a;
    color: #fff;
    font-family: 'Be Vietnam Pro', sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h2 {
    color: #ff2e2e;
    text-shadow: 0 0 20px #ff0000, 0 0 40px #ff2e2e;
    margin-bottom: 20px;
    font-size: 1.8em;
  }
  button {
    background: #ff2e2e;
    border: none;
    color: white;
    padding: 8px 16px;
    margin: 6px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.25s;
    font-weight: 500;
  }
  button:hover {
    background: #ff5555;
    box-shadow: 0 0 15px #ff2e2e;
  }
  #loginBtn {
    margin-top: 50px;
    font-size: 1.05em;
  }
  #content {
    display: none;
    margin-top: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: #151515;
    border-radius: 8px;
    box-shadow: 0 0 15px #ff2e2e55;
    overflow: hidden;
    margin-top: 15px;
  }
  th, td {
    padding: 10px;
    border-bottom: 1px solid #333;
  }
  th {
    background: #1b1b1b;
    color: #ff2e2e;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  tr:hover {
    background: rgba(255,255,255,0.05);
  }
  #clearBtn {
    margin-top: 20px;
    background: linear-gradient(90deg, #ff2e2e, #ff7575);
    box-shadow: 0 0 15px #ff2e2e88;
  }
  footer {
    margin-top: 30px;
    opacity: 0.7;
    font-size: 0.85em;
  }
</style>
</head>

<body>
<h2>üß© ShynChat Admin Panel v5.1</h2>

<div id="login">
  <button id="loginBtn">ƒêƒÉng nh·∫≠p b·∫±ng Google</button>
</div>

<div id="content">
  <h3>üë• Danh s√°ch ng∆∞·ªùi d√πng</h3>
  <table id="tbl">
    <tr>
      <th>T√™n</th>
      <th>Email</th>
      <th>Tr·∫°ng th√°i</th>
      <th>H√†nh ƒë·ªông</th>
    </tr>
  </table>
  <button id="clearBtn">üßπ X√≥a to√†n b·ªô tin nh·∫Øn (Ph√≤ng chung)</button>
</div>

<footer>Created by <b>ShynMMO ¬©2025</b> | Powered by Firebase</footer>

<script>
// ================= Firebase Config =================
const firebaseConfig = {
  apiKey: "AIzaSyDs3VrMSUnb7kl0MWYbMxnqR78anJ2SgJs",
  authDomain: "shynchat.firebaseapp.com",
  databaseURL: "https://shynchat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "shynchat",
  storageBucket: "shynchat.firebasestorage.app",
  messagingSenderId: "180611398927",
  appId: "1:180611398927:web:2566534da0f8f6935f927a"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const provider = new firebase.auth.GoogleAuthProvider();

const ADMIN_EMAIL = "pn23070999@gmail.com";

const loginDiv = document.getElementById("login");
const loginBtn = document.getElementById("loginBtn");
const contentDiv = document.getElementById("content");
const tbl = document.getElementById("tbl");
const clearBtn = document.getElementById("clearBtn");

// ================= ƒêƒÉng nh·∫≠p Google =================
loginBtn.onclick = () => {
  auth.signInWithPopup(provider)
    .catch(err => alert("‚ùå L·ªói ƒëƒÉng nh·∫≠p: " + err.message));
};

auth.onAuthStateChanged(user => {
  if (!user || !user.email) return;
  
  const userEmail = user.email.toLowerCase();
  if (userEmail !== ADMIN_EMAIL.toLowerCase()) {
    alert("üö´ Truy c·∫≠p b·ªã t·ª´ ch·ªëi! Ch·ªâ Admin m·ªõi ƒë∆∞·ª£c ph√©p v√†o trang n√†y.");
    auth.signOut();
    location.href = "index.html";
    return;
  }

  loginDiv.style.display = "none";
  contentDiv.style.display = "block";
  loadUsers();
});

// ================= Load danh s√°ch User =================
function loadUsers() {
  db.ref("users").on("value", snap => {
    tbl.innerHTML = `
      <tr>
        <th>T√™n</th>
        <th>Email</th>
        <th>Tr·∫°ng th√°i</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    `;
    snap.forEach(child => {
      const u = child.val();
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.name || "(Kh√¥ng t√™n)"}</td>
        <td>${u.email || "(Kh√¥ng email)"}</td>
        <td>${u.online ? "üü¢ Online" : "üî¥ Offline"}</td>
        <td><button onclick="banUser('${child.key}')">Ban</button></td>
      `;
      tbl.appendChild(tr);
    });
  });
}

// ================= Ban ng∆∞·ªùi d√πng =================
function banUser(uid) {
  if (confirm("‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën c·∫•m ng∆∞·ªùi d√πng n√†y kh√¥ng?")) {
    db.ref("users/" + uid).remove()
      .then(() => alert("‚úÖ ƒê√£ c·∫•m ng∆∞·ªùi d√πng th√†nh c√¥ng!"))
      .catch(err => alert("‚ùå L·ªói: " + err.message));
  }
}

// ================= X√≥a to√†n b·ªô chat =================
clearBtn.onclick = () => {
  const confirmDelete = confirm("üßπ B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô tin nh·∫Øn trong PH√íNG CHUNG kh√¥ng?\nThao t√°c n√†y KH√îNG th·ªÉ ho√†n t√°c!");
  if (!confirmDelete) return;

  db.ref("rooms/public").remove()
    .then(() => alert("‚úÖ To√†n b·ªô tin nh·∫Øn ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng!"))
    .catch(err => alert("‚ùå L·ªói khi x√≥a: " + err.message));
};
</script>
</body>
</html>
