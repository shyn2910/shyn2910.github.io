<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShynChat Pro v7.0 | ShynSuite</title>
  <link rel="icon" href="data:,">
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Be Vietnam Pro', sans-serif;
      background: radial-gradient(circle at top, #0d0d0d, #000);
      color: #fff;
      text-align: center;
      margin: 0;
    }
    header {
      padding: 15px;
      color: #ff2e2e;
      text-shadow: 0 0 15px #ff0000, 0 0 30px #ff2e2e;
      font-size: 1.5em;
    }
    #loginDiv {
      margin-top: 100px;
    }
    input {
      display: block;
      margin: 10px auto;
      padding: 10px;
      border-radius: 6px;
      border: none;
      width: 260px;
      background: #111;
      color: #fff;
    }
    button {
      background: #ff2e2e;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover {
      background: #ff5555;
      box-shadow: 0 0 10px #ff2e2e;
    }
    #chatBox {
      display: none;
      width: 85%;
      max-width: 800px;
      margin: 20px auto;
      background: #111;
      border-radius: 12px;
      box-shadow: 0 0 25px #ff2e2e55;
      padding: 10px;
    }
    #messages {
      height: 420px;
      overflow-y: auto;
      background: #000;
      border-radius: 10px;
      padding: 10px;
      text-align: left;
    }
    .message {
      margin-bottom: 10px;
      padding: 6px 10px;
      border-radius: 8px;
      background: #1a1a1a;
    }
    .sender { color: #ff2e2e; font-weight: bold; }
    #adminBtn { background:none;border:none;color:#ff2e2e;font-size:1.3em;cursor:pointer;margin-left:5px;display:none; }
    #adminPanel {
      display:none;position:absolute;right:30px;top:90px;background:rgba(20,0,0,0.9);
      border:1px solid #ff2e2e66;border-radius:10px;box-shadow:0 0 15px #ff000066;
      padding:10px;width:260px;text-align:left;z-index:999;
    }
    #adminPanel button { background:#ff2e2e;color:#fff;border:none;border-radius:6px;padding:6px 10px;margin-top:6px;cursor:pointer; }
  </style>
</head>
<body>
  <header>üí¨ ShynChat Pro v7.0 | ShynSuite</header>

  <div id="loginDiv">
    <input type="email" id="email" placeholder="Gmail...">
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u...">
    <button id="loginBtn">ƒêƒÉng nh·∫≠p</button>
    <p>Ch∆∞a c√≥ t√†i kho·∫£n? <a href="register.html" style="color:#ff2e2e">ƒêƒÉng k√Ω</a></p>
  </div>

  <div id="chatBox">
    <div id="userName">
      <span id="displayName"></span>
      <button id="adminBtn" title="Admin Panel">üëë</button>
    </div>
    <div id="messages"></div>
    <div>
      <input type="text" id="messageInput" placeholder="Nh·∫≠p tin nh·∫Øn... (Enter g·ª≠i)">
      <button id="sendBtn">G·ª≠i</button>
      <button id="logoutBtn">ƒêƒÉng xu·∫•t</button>
    </div>
  </div>

  <div id="adminPanel">
    <h3>üëë Admin Panel</h3>
    <div id="userList"></div>
    <button id="clearChatBtn">üßπ X√≥a to√†n b·ªô chat</button>
  </div>

  <footer>Created by <b>ShynMMO ¬©2025</b></footer>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDs3VrMSUnb7kl0MWYbMxnqR78anJ2SgJs",
  authDomain: "shynchat.firebaseapp.com",
  databaseURL: "https://shynchat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "shynchat",
  storageBucket: "shynchat.firebasestorage.app",
  messagingSenderId: "180611398927",
  appId: "1:180611398927:web:2566534da0f8f6935f927a"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const ADMIN_EMAIL = "pn23070999@gmail.com";

const loginDiv = document.getElementById("loginDiv");
const chatBox = document.getElementById("chatBox");
const emailInput = document.getElementById("email");
const passInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const displayName = document.getElementById("displayName");
const adminBtn = document.getElementById("adminBtn");
const adminPanel = document.getElementById("adminPanel");
const messages = document.getElementById("messages");
const msgInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userList = document.getElementById("userList");
const clearChatBtn = document.getElementById("clearChatBtn");

loginBtn.onclick = () => {
  auth.signInWithEmailAndPassword(emailInput.value, passInput.value)
  .catch(err => alert("L·ªói: " + err.message));
};

logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  if (!user) {
    chatBox.style.display = "none";
    loginDiv.style.display = "block";
    return;
  }
  loginDiv.style.display = "none";
  chatBox.style.display = "block";
  displayName.textContent = user.email;

  db.ref("users/" + user.uid).update({ email: user.email, online: true });

  loadMessages();

  if (user.email === ADMIN_EMAIL) {
    adminBtn.style.display = "inline";
    adminBtn.onclick = () => {
      adminPanel.style.display = adminPanel.style.display === "block" ? "none" : "block";
    };
    loadAdminPanel();
  }
});

window.onbeforeunload = () => {
  const user = auth.currentUser;
  if (user) db.ref("users/" + user.uid + "/online").set(false);
};

function loadMessages() {
  db.ref("rooms/public").on("child_added", snap => {
    const m = snap.val();
    const div = document.createElement("div");
    div.className = "message";
    div.innerHTML = `<span class='sender'>${m.sender}:</span> ${m.text}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });
}

sendBtn.onclick = () => {
  const user = auth.currentUser;
  if (!user) return;
  const text = msgInput.value.trim();
  if (!text) return;
  db.ref("rooms/public").push({
    sender: user.email,
    text: text,
    time: Date.now()
  });
  msgInput.value = "";
};

msgInput.addEventListener("keydown", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendBtn.click();
  }
});

function loadAdminPanel() {
  db.ref("users").on("value", snap => {
    userList.innerHTML = "";
    snap.forEach(child => {
      const u = child.val();
      const div = document.createElement("div");
      div.innerHTML = `<b>${u.email}</b> - ${u.online ? "üü¢" : "üî¥"}
        <button onclick="banUser('${child.key}')">Ban</button>`;
      userList.appendChild(div);
    });
  });
}

function banUser(uid) {
  if (confirm("C·∫•m ng∆∞·ªùi d√πng n√†y?")) {
    db.ref("users/" + uid).remove().then(() => alert("ƒê√£ c·∫•m user!"));
  }
}

clearChatBtn.onclick = () => {
  if (confirm("X√≥a to√†n b·ªô tin nh·∫Øn ph√≤ng chung?")) {
    db.ref("rooms/public").remove().then(() => alert("ƒê√£ x√≥a to√†n b·ªô chat!"));
  }
};
</script>
</body>
</html>
