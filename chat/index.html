<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üí¨ ShynChat Pro v6.0 | ShynSuite</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-database-compat.js"></script>

<style>
body {
  font-family: 'Be Vietnam Pro', sans-serif;
  background: radial-gradient(circle at top, #0d0d0d, #000);
  color: #fff;
  text-align: center;
  margin: 0;
  padding: 0;
}
header {
  padding: 15px;
  color: #ff2e2e;
  text-shadow: 0 0 15px #ff0000, 0 0 30px #ff2e2e;
  font-size: 1.5em;
}
#chatBox {
  width: 85%;
  max-width: 800px;
  margin: 20px auto;
  background: #111;
  border-radius: 12px;
  box-shadow: 0 0 25px #ff2e2e55;
  padding: 10px;
}
#messages {
  height: 420px;
  overflow-y: auto;
  background: #000;
  border-radius: 10px;
  border: 1px solid #222;
  text-align: left;
  padding: 10px;
}
.message {
  margin-bottom: 10px;
  padding: 6px 10px;
  border-radius: 8px;
  background: #1a1a1a;
}
.sender {
  color: #ff2e2e;
  font-weight: bold;
}
#inputArea {
  margin-top: 10px;
}
#messageInput {
  width: 65%;
  padding: 8px;
  border-radius: 8px;
  border: none;
  outline: none;
}
button {
  background: #ff2e2e;
  border: none;
  color: white;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
  margin-left: 5px;
}
button:hover {
  background: #ff5555;
  box-shadow: 0 0 10px #ff2e2e;
}
#userName {
  margin-bottom: 10px;
  font-weight: 600;
  color: #ff2e2e;
  text-shadow: 0 0 8px #ff0000;
}
#adminBtn {
  background: none;
  border: none;
  color: #ff2e2e;
  font-size: 1.3em;
  cursor: pointer;
  margin-left: 5px;
  text-shadow: 0 0 10px #ff0000;
  display: none;
}
#adminBtn:hover {
  transform: scale(1.2);
  color: #ff5555;
}
#adminPanel {
  display: none;
  position: absolute;
  right: 30px;
  top: 90px;
  background: rgba(20, 0, 0, 0.9);
  border: 1px solid #ff2e2e66;
  border-radius: 10px;
  box-shadow: 0 0 15px #ff000066;
  padding: 10px;
  width: 260px;
  text-align: left;
  z-index: 999;
}
#adminPanel h3 {
  margin: 0 0 5px;
  color: #ff2e2e;
  text-shadow: 0 0 10px #ff0000;
  font-size: 1em;
}
#adminPanel button {
  background: #ff2e2e;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 6px 10px;
  margin-top: 6px;
  cursor: pointer;
  transition: 0.2s;
}
#adminPanel button:hover {
  background: #ff5555;
  box-shadow: 0 0 10px #ff2e2e;
}
footer {
  margin-top: 20px;
  opacity: 0.6;
  font-size: 0.9em;
}
</style>
</head>
<body>

<header>üí¨ ShynChat Pro v6.0 | ShynSuite</header>

<div id="loginDiv">
  <button id="loginBtn">ƒêƒÉng nh·∫≠p b·∫±ng Google</button>
</div>

<div id="chatBox" style="display:none">
  <div id="userName">
    <span id="displayName"></span>
    <button id="adminBtn" title="Admin Panel">üëë</button>
  </div>
  <div id="messages"></div>
  <div id="inputArea">
    <input type="text" id="messageInput" placeholder="Nh·∫≠p tin nh·∫Øn... (Enter g·ª≠i / Shift+Enter xu·ªëng d√≤ng)">
    <button id="sendBtn">G·ª≠i</button>
    <button id="logoutBtn">ƒêƒÉng xu·∫•t</button>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h3>üëë Admin Panel</h3>
  <div id="userList"></div>
  <button id="clearChatBtn">üßπ X√≥a to√†n b·ªô chat</button>
</div>

<footer>Created by <b>ShynMMO ¬©2025</b> | Powered by Firebase</footer>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDs3VrMSUnb7kl0MWYbMxnqR78anJ2SgJs",
  authDomain: "shynchat.firebaseapp.com",
  databaseURL: "https://shynchat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "shynchat",
  storageBucket: "shynchat.firebasestorage.app",
  messagingSenderId: "180611398927",
  appId: "1:180611398927:web:2566534da0f8f6935f927a"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const provider = new firebase.auth.GoogleAuthProvider();

const ADMIN_EMAIL = "pn23070999@gmail.com";
let currentUser = null;

const loginBtn = document.getElementById("loginBtn");
const loginDiv = document.getElementById("loginDiv");
const chatBox = document.getElementById("chatBox");
const displayName = document.getElementById("displayName");
const adminBtn = document.getElementById("adminBtn");
const messages = document.getElementById("messages");
const msgInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const logoutBtn = document.getElementById("logoutBtn");
const adminPanel = document.getElementById("adminPanel");
const userList = document.getElementById("userList");
const clearChatBtn = document.getElementById("clearChatBtn");

// ƒêƒÉng nh·∫≠p Google
loginBtn.onclick = () => auth.signInWithPopup(provider).catch(e => alert("L·ªói ƒëƒÉng nh·∫≠p: " + e.message));

// ƒêƒÉng xu·∫•t
logoutBtn.onclick = () => auth.signOut();

// Khi ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p
auth.onAuthStateChanged(user => {
  if (!user) {
    chatBox.style.display = "none";
    loginDiv.style.display = "block";
    adminBtn.style.display = "none";
    return;
  }

  currentUser = user;
  loginDiv.style.display = "none";
  chatBox.style.display = "block";
  displayName.textContent = user.displayName;

  // Ghi nh·∫≠n ng∆∞·ªùi d√πng online
  db.ref("users/" + user.uid).update({
    name: user.displayName,
    email: user.email,
    online: true
  });

  loadMessages();

  // N·∫øu l√† Admin
  if (user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase()) {
    adminBtn.style.display = "inline";
    adminBtn.onclick = () => {
      adminPanel.style.display = adminPanel.style.display === "block" ? "none" : "block";
    };
    loadAdminPanel();
  }
});

// Khi t·∫Øt tab, set offline
window.onbeforeunload = () => {
  if (currentUser) db.ref("users/" + currentUser.uid + "/online").set(false);
};

// Hi·ªÉn th·ªã tin nh·∫Øn
function loadMessages() {
  db.ref("rooms/public").on("child_added", snap => {
    const m = snap.val();
    const div = document.createElement("div");
    div.className = "message";
    div.innerHTML = `<span class='sender'>${m.sender}:</span> ${m.text}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });
}

// G·ª≠i tin nh·∫Øn
sendBtn.onclick = () => {
  const text = msgInput.value.trim();
  if (!text) return;
  db.ref("rooms/public").push({
    sender: currentUser.displayName,
    text: text,
    time: Date.now()
  });
  msgInput.value = "";
};

// Enter g·ª≠i, Shift+Enter xu·ªëng d√≤ng
msgInput.addEventListener("keydown", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendBtn.click();
  }
});

// Admin Panel
function loadAdminPanel() {
  db.ref("users").on("value", snap => {
    userList.innerHTML = "";
    snap.forEach(child => {
      const u = child.val();
      const div = document.createElement("div");
      div.innerHTML = `
        <b>${u.name || "Kh√¥ng t√™n"}</b> (${u.email || ""})
        - ${u.online ? "üü¢" : "üî¥"}
        <button onclick="banUser('${child.key}')">Ban</button>
      `;
      userList.appendChild(div);
    });
  });
}

function banUser(uid) {
  if (confirm("C·∫•m ng∆∞·ªùi d√πng n√†y?")) {
    db.ref("users/" + uid).remove().then(() => alert("ƒê√£ c·∫•m user th√†nh c√¥ng!"));
  }
}

clearChatBtn.onclick = () => {
  if (confirm("X√≥a to√†n b·ªô tin nh·∫Øn ph√≤ng chung?")) {
    db.ref("rooms/public").remove().then(() => alert("ƒê√£ x√≥a to√†n b·ªô chat!"));
  }
};
</script>
</body>
</html>
