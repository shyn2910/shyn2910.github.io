<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ShynChat Pro v5.0 üí¨ | ShynSuite</title>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-storage-compat.js"></script>
<style>
:root{--bg:#0a0a0a;--text:#fff;--msg:#1b1b1b;--accent:#ff2e2e;}
body.light{--bg:#f5f5f5;--text:#111;--msg:#fff;--accent:#ff5555;}
body{font-family:'Be Vietnam Pro',sans-serif;background:var(--bg);color:var(--text);
display:flex;flex-direction:column;align-items:center;margin:0;text-align:center;
transition:background .3s,color .3s;}
h2{margin-top:20px;color:var(--accent);text-shadow:0 0 15px var(--accent);}
#chat-container{display:none;width:90%;max-width:700px;border:1px solid var(--accent);
border-radius:10px;box-shadow:0 0 25px var(--accent);margin-top:20px;padding:15px;
background:var(--msg);}
#chat-box{height:55vh;overflow-y:auto;padding:10px;border-radius:8px;background:var(--bg);
box-shadow:inset 0 0 10px var(--accent);}
.msg{margin:8px 0;background:var(--msg);padding:10px;border-radius:8px;text-align:left;
position:relative;}
.msg:hover{background:rgba(255,255,255,0.08);}
.msg img{max-width:160px;border-radius:6px;margin-top:4px;}
.user{font-weight:bold;color:var(--accent);cursor:pointer;}
.time{font-size:.75em;opacity:.7;}
#typing{font-style:italic;color:#aaa;margin:4px 0;height:20px;}
#online-users{margin:10px 0;padding:10px;background:var(--bg);border-radius:8px;}
textarea{width:90%;background:var(--msg);color:var(--text);border-radius:6px;
border:1px solid var(--accent);padding:8px;resize:none;}
button{background:var(--accent);border:none;color:#fff;padding:6px 12px;margin:5px;
border-radius:6px;cursor:pointer;}
#theme-toggle{position:fixed;top:10px;right:10px;cursor:pointer;}
#room-label{margin-bottom:10px;font-weight:bold;text-transform:uppercase;
color:var(--accent);text-shadow:0 0 10px var(--accent);}
</style>
</head>
<body>
<h2>üí¨ ShynChat Pro v5.0 | Realtime</h2>
<button id="theme-toggle">üåô</button>

<div id="login-section"><button id="googleLogin">ƒêƒÉng nh·∫≠p b·∫±ng Google</button></div>

<div id="chat-container">
  <div id="user-info"></div>
  <div id="room-label">PH√íNG CHUNG</div>
  <div id="online-users"></div>
  <div id="chat-box"></div>
  <div id="typing"></div>
  <textarea id="message" placeholder="Nh·∫≠p tin nh·∫Øn... (Enter = g·ª≠i, Shift+Enter = xu·ªëng d√≤ng)"></textarea><br>
  <input type="file" id="imageInput" accept="image/*">
  <button onclick="sendMessage()">G·ª≠i</button>
  <button onclick="logout()">ƒêƒÉng xu·∫•t</button>
</div>
<audio id="notifSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>

<script>
const firebaseConfig={apiKey:"AIzaSyDs3VrMSUnb7kl0MWYbMxnqR78anJ2SgJs",
authDomain:"shynchat.firebaseapp.com",
databaseURL:"https://shynchat-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"shynchat",storageBucket:"shynchat.firebasestorage.app",
messagingSenderId:"180611398927",
appId:"1:180611398927:web:2566534da0f8f6935f927a"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.database(),storage=firebase.storage();
const provider=new firebase.auth.GoogleAuthProvider();

const login=document.getElementById("login-section"),
chat=document.getElementById("chat-container"),
msg=document.getElementById("message"),img=document.getElementById("imageInput"),
box=document.getElementById("chat-box"),users=document.getElementById("online-users"),
typing=document.getElementById("typing"),notif=document.getElementById("notifSound"),
theme=document.getElementById("theme-toggle"),roomLabel=document.getElementById("room-label");

let currentUser=null,isAdmin=false,currentRoom="public",typingTimer;

document.getElementById("googleLogin").onclick=()=>auth.signInWithPopup(provider);

auth.onAuthStateChanged(u=>{
 if(!u){login.style.display="block";chat.style.display="none";return;}
 currentUser=u;isAdmin=(u.email==="pn23070999@gmail.com");
 login.style.display="none";chat.style.display="block";
 document.getElementById("user-info").innerHTML=
 `<img src="${u.photoURL}" width="40" style="border-radius:50%"> ${u.displayName}`+
 (isAdmin?" <span style='color:#ff2e2e'>(Admin)</span>":"");
 setUserOnline(true);loadUsers();loadMessages();setupTyping();
});

function setUserOnline(state){
 const ref=db.ref("users/"+currentUser.uid);
 ref.set({name:currentUser.displayName,email:currentUser.email,online:state});
 window.addEventListener("beforeunload",()=>ref.update({online:false}));
 ref.onDisconnect().update({online:false});
}
function logout(){db.ref("users/"+currentUser.uid).update({online:false});auth.signOut();}

function loadUsers(){
 db.ref("users").on("value",s=>{
  users.innerHTML="<b>üü¢ Online:</b><br>";
  s.forEach(c=>{
   const u=c.val();if(!u.name)return;
   const d=document.createElement("div");
   d.textContent=u.name+(u.online?" üü¢":" üî¥");
   d.className="user";
   d.oncontextmenu=e=>{
    e.preventDefault();
    const act=prompt("Ch·ªçn h√†nh ƒë·ªông: Chat / Ban");
    if(act?.toLowerCase()==="chat")startPrivate(u.name);
    if(act?.toLowerCase()==="ban"&&isAdmin)db.ref("users/"+c.key).remove();
   };
   users.appendChild(d);
  });
 });
}

function loadMessages(){
 box.innerHTML="";
 db.ref("rooms/"+currentRoom).off();
 db.ref("rooms/"+currentRoom).on("child_added",s=>{
  const d=s.val(),div=document.createElement("div");
  div.className="msg";
  div.innerHTML=`<span class="user">${d.userName}</span>: ${d.text||""}
  ${d.imageUrl?`<img src="${d.imageUrl}">`:""}
  <div class="time">${new Date(d.time).toLocaleTimeString()}</div>`;
  div.oncontextmenu=e=>{
   e.preventDefault();
   if(isAdmin&&confirm("X√≥a tin n√†y?"))db.ref("rooms/"+currentRoom+"/"+s.key).remove();
  };
  div.ondblclick=()=>div.innerHTML+=" üòä";
  box.appendChild(div);box.scrollTop=box.scrollHeight;
  if(d.userEmail!==currentUser.email)notif.play();
 });
}

async function sendMessage(){
 const text=msg.value.trim(),file=img.files[0];
 if(!text&&!file)return;
 let imageUrl=null;
 if(file){
  const r=storage.ref("chatImages/"+Date.now()+"_"+file.name);
  await r.put(file);imageUrl=await r.getDownloadURL();img.value="";
 }
 db.ref("rooms/"+currentRoom).push({
  userName:currentUser.displayName,userEmail:currentUser.email,
  text,imageUrl,time:Date.now()
 });
 msg.value="";db.ref("typing/"+currentRoom+"/"+currentUser.uid).remove();
}

msg.addEventListener("keydown",e=>{
 if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendMessage();}
 else{
  db.ref("typing/"+currentRoom+"/"+currentUser.uid).set(currentUser.displayName);
  clearTimeout(typingTimer);
  typingTimer=setTimeout(()=>db.ref("typing/"+currentRoom+"/"+currentUser.uid).remove(),3000);
 }
});

function setupTyping(){
 db.ref("typing/"+currentRoom).on("value",s=>{
  const val=s.val();
  if(!val){typing.textContent="";return;}
  const names=Object.values(val).filter(n=>n!==currentUser.displayName);
  typing.textContent=names.length?`${names.join(", ")} ƒëang nh·∫≠p...`:"";
 });
}

function startPrivate(target){
 if(target===currentUser.displayName)return;
 currentRoom=`private_${[currentUser.displayName,target].sort().join("_")}`;
 roomLabel.textContent="PH√íNG RI√äNG: "+target;
 loadMessages();setupTyping();
}

let dark=true;
theme.onclick=()=>{dark=!dark;document.body.classList.toggle("light",!dark);
 theme.textContent=dark?"üåô":"‚òÄÔ∏è";};
</script>
</body>
</html>

